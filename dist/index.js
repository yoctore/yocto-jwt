var _=require("lodash"),logger=require("yocto-logger");exports.decryptor=function(a,b,c){logger.debug("-------------------------------"),logger.debug("[ decryptor ] - new incoming request, encrypted body is : "),logger.debug(JSON.stringify(a.body));var d=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/;_.each(a.body,function(b,c){if(b.match(d)&&b.length%4===0){var e=new Buffer(b,"base64"),f=e.toString();try{f=JSON.parse(f),_.each(f,function(b,c){a.body[c]=b})}catch(g){a.body[c]=f}}else logger.debug(c+" is not a encode base 64")}),logger.debug("[ decryptor ]  - decrypted body is : "),logger.debug(a.body),c()},exports.encryptor=function(){return function(a,b,c){if(3!==arguments.length||!_.isObject(a)||!_.isObject(b)||!_.isObject(c))return c();var d={headers:b._headers};b.realSend=b.send,b.jsonp=function(a,c){2===arguments.length?(d.status=a,d.body=c):(d.status=b.statusCode,d.body=a);var e=new Buffer(JSON.stringify(d.body)),f=e.toString("base64");return logger.debug("[ encryptor ] - encryptedData : "),logger.debug(f),b.realSend(f)},c()}};